<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topic 3: Fragment Lifecycle & Memory Leaks ‚Äî Research Coach</title>
    <meta name="description"
        content="Research methodology guide for studying Fragment lifecycles, debugging memory leaks, and using LeakCanary in Android.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Serif+Display&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['DM Sans', 'sans-serif'], serif: ['DM Serif Display', 'serif'] },
                    colors: { tru: { primary: '#003C5C', 'primary-light': '#0A5A7C', secondary: '#00594C', 'secondary-light': '#007A68', accent: '#E8963E', 'accent-light': '#F0AE6A' } }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../styles.css">
</head>

<body class="min-h-screen bg-gray-50">

    <!-- HERO -->
    <header class="topic-hero text-white">
        <div class="relative z-10 max-w-6xl mx-auto px-6 py-12 md:py-16">
            <a href="../index.html" class="back-link mb-6 inline-flex">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Back to All Topics
            </a>
            <div class="flex items-center gap-3 mt-6 mb-4">
                <span class="topic-number text-lg" style="background:rgba(255,255,255,0.2);">03</span>
                <span class="category-badge badge-logic" style="background:rgba(255,255,255,0.15);color:#fff;">Logic
                    &amp; Architecture</span>
            </div>
            <h1 class="font-serif text-3xl md:text-4xl lg:text-5xl leading-tight mb-4">
                Fragment Lifecycle &amp;<br>Memory Leaks
            </h1>
            <p class="text-white/80 text-lg max-w-3xl leading-relaxed">
                Master the delicate dance of Fragments. You'll learn how to spot "memory leaks" before they crash your
                app, use LeakCanary like a pro, and ensure your app's state survives the dreaded screen rotation.
            </p>
        </div>
    </header>

    <!-- MAIN -->
    <div class="max-w-6xl mx-auto px-6 py-10">
        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Sidebar -->
            <aside class="lg:w-64 flex-shrink-0">
                <nav class="sidebar-nav sticky top-6 bg-white rounded-2xl border p-4 shadow-sm"
                    style="border-color:var(--border-light);">
                    <h4 class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-3 px-3">On This Page</h4>
                    <a href="#overview" class="active">üìã Research Overview</a>
                    <a href="#background">üìö Background Reading</a>
                    <a href="#key-concepts">üí° Key Concepts</a>
                    <a href="#methodology">üî¨ Methodology</a>
                    <a href="#experiments">üß™ Experiments</a>
                    <a href="#alternatives">üîÑ Alternative Approaches</a>
                    <a href="#poster-tips">üé® Poster Tips</a>
                    <a href="#pitfalls">‚ö†Ô∏è Common Pitfalls</a>
                    <a href="#checklist">‚úÖ Checklist</a>
                </nav>
            </aside>

            <!-- Content -->
            <main class="flex-1 min-w-0">

                <!-- OVERVIEW -->
                <section id="overview" class="content-section animate-in">
                    <h2>üìã Research Overview</h2>
                    <p class="text-gray-600 leading-relaxed mb-4">Fragments are modular parts of an Activity. They are
                        powerful but have complex "lifecycles" (rules for when they are created, shown, and destroyed).
                        If a Fragment is "closed" but the app accidentally keeps a reference to its views, you have a
                        <strong>Memory Leak</strong>.</p>
                    <p class="text-gray-600 leading-relaxed mb-4">Your research will explore the hidden dangers of
                        Fragment management. You'll use industry-standard tools like <strong>LeakCanary</strong> to find
                        and fix leaks, and study how <strong>Configuration Changes</strong> (like rotating your phone)
                        affect your app's memory.</p>

                    <div class="callout callout-info">
                        <div class="callout-icon">üí°</div>
                        <div><strong>Did you know?</strong> A single leaked Fragment can keep an entire Activity (and
                            its huge layout) stuck in memory, eventually causing your app to run out of RAM and crash.
                        </div>
                    </div>

                    <h3>What Will Your Research Poster Show?</h3>
                    <ul class="list-disc list-inside text-gray-600 space-y-2 ml-2">
                        <li>Diagrams of the Fragment Lifecycle vs. Activity Lifecycle</li>
                        <li>LeakCanary "Leak Traces" (screenshots showing where a bug is hiding)</li>
                        <li>Examples of "Clean" vs. "Leaky" code</li>
                        <li>Data on how much memory is lost during repeated rotations</li>
                        <li>Best practices for using View Binding safely</li>
                    </ul>
                </section>

                <!-- BACKGROUND -->
                <section id="background" class="content-section animate-in">
                    <h2>üìö Background Reading</h2>
                    <p class="text-gray-600 leading-relaxed mb-4">Start by understanding how Android manages memory and
                        lifecycles.</p>

                    <div class="space-y-3">
                        <div class="bg-gray-50 rounded-xl p-4 border" style="border-color:var(--border-light);">
                            <h4 class="font-semibold text-tru-primary text-sm mb-1">üìñ Official Android Documentation
                            </h4>
                            <ul class="text-sm text-gray-600 space-y-1 ml-4 list-disc">
                                <li><a href="https://developer.android.com/guide/fragments/lifecycle"
                                        class="text-tru-secondary hover:underline" target="_blank">Fragment Lifecycle
                                        Guide</a> ‚Äî The source of truth</li>
                                <li><a href="https://developer.android.com/topic/libraries/view-binding"
                                        class="text-tru-secondary hover:underline" target="_blank">View Binding
                                        Guide</a> ‚Äî Pay attention to the Fragment section!</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-4 border" style="border-color:var(--border-light);">
                            <h4 class="font-semibold text-tru-primary text-sm mb-1">üê£ Beginner-Friendly Resources</h4>
                            <ul class="text-sm text-gray-600 space-y-1 ml-4 list-disc">
                                <li><a href="https://square.github.io/leakcanary/"
                                        class="text-tru-secondary hover:underline" target="_blank">LeakCanary
                                        Documentation</a> ‚Äî "A canary in a coal mine" for memory leaks</li>
                                <li>Search: <em>"Android memory leaks for beginners"</em> ‚Äî Common pitfalls like static
                                    variables</li>
                            </ul>
                        </div>

                        <div class="callout callout-tip">
                            <div class="callout-icon">üìå</div>
                            <div><strong>Reading Tip:</strong> Pay close attention to the `onDestroyView()` method. This
                                is where most Fragment leaks are born!</div>
                        </div>
                    </div>
                </section>

                <!-- KEY CONCEPTS -->
                <section id="key-concepts" class="content-section animate-in">
                    <h2>üí° Key Concepts</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl p-5 border border-teal-100">
                            <h4 class="font-semibold text-tru-primary mb-2">Memory Leak</h4>
                            <p class="text-sm text-gray-600">A bug where the app "forgets" to release memory that it no
                                longer needs. It's like checking out of a hotel room but leaving all your luggage there
                                ‚Äî the hotel can't give the room to a new guest.</p>
                        </div>
                        <div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl p-5 border border-teal-100">
                            <h4 class="font-semibold text-tru-primary mb-2">Garbage Collector (GC)</h4>
                            <p class="text-sm text-gray-600">The automatic system in Android that finds unused objects
                                and deletes them to free up space. Leaks happen when the GC is "tricked" into thinking
                                an object is still in use.</p>
                        </div>
                        <div
                            class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-5 border border-amber-100">
                            <h4 class="font-semibold text-tru-primary mb-2">Configuration Change</h4>
                            <p class="text-sm text-gray-600">Events like rotating the screen or changing language. When
                                this happens, Android <strong>destroys and recreates</strong> your Activity and
                                Fragments. This is a prime time for memory leaks to occur.</p>
                        </div>
                        <div
                            class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-5 border border-amber-100">
                            <h4 class="font-semibold text-tru-primary mb-2">Static Reference</h4>
                            <p class="text-sm text-gray-600">A variable that lives for the entire duration of the app.
                                If you store a Fragment in a <code class="bg-white px-1 rounded text-xs">static</code>
                                variable, it will <em>never</em> be garbage collected, even after the user leaves that
                                screen.</p>
                        </div>
                    </div>
                </section>

                <!-- METHODOLOGY -->
                <section id="methodology" class="content-section animate-in">
                    <h2>üî¨ Step-by-Step Methodology</h2>
                    <p class="text-gray-600 leading-relaxed mb-6">Learn how to be a "memory detective" by following this
                        process.</p>

                    <div class="step-card">
                        <div class="flex items-start gap-3">
                            <span class="step-number">1</span>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Install LeakCanary</h4>
                                <p class="text-sm text-gray-600 mb-3">Add this single line to your <code
                                        class="bg-gray-100 px-1 rounded text-xs">build.gradle</code> file. It works
                                    automatically!</p>
                                <div class="code-block"><span class="code-label">Gradle</span>
                                    <pre>dependencies {
  // Only for debug builds
  debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.12'
}</pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-card">
                        <div class="flex items-start gap-3">
                            <span class="step-number">2</span>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Create a "Leaky" Fragment</h4>
                                <p class="text-sm text-gray-600 mb-3">One of the most common leaks in Fragments is not
                                    nullifying the View Binding. Implement a Fragment that purposely keeps a reference
                                    to its views.</p>
                                <div class="code-block"><span class="code-label">Kotlin</span>
                                    <pre>// The WRONG way (Leaky)
class LeakyFragment : Fragment(R.layout.fragment_leaky) {
    private lateinit var binding: FragmentLeakyBinding

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        binding = FragmentLeakyBinding.bind(view)
    }
    // MISSING: onDestroyView { binding = null }
}</pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-card">
                        <div class="flex items-start gap-3">
                            <span class="step-number">3</span>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Trigger the Leak</h4>
                                <p class="text-sm text-gray-600 mb-3">A leak usually happens when a Fragment's
                                    <strong>view</strong> is destroyed but the Fragment instance lives on (e.g., when
                                    it's moved to the "Back Stack").</p>
                                <ol class="text-sm text-gray-600 space-y-2 ml-4 list-decimal">
                                    <li>Navigate to your <code
                                            class="bg-gray-50 px-1 rounded text-xs">LeakyFragment</code></li>
                                    <li>Perform a transaction to <strong>replace</strong> it with another Fragment and
                                        use <code class="bg-gray-50 px-1 rounded text-xs">addToBackStack()</code></li>
                                    <li>Wait 10-20 seconds</li>
                                    <li>Check if a LeakCanary notification appears!</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <div class="step-card">
                        <div class="flex items-start gap-3">
                            <span class="step-number">4</span>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Analyze the Leak Trace</h4>
                                <p class="text-sm text-gray-600 mb-2">Open the LeakCanary app on your device (it appears
                                    as a separate icon). Look at the "Leak Trace" ‚Äî it will show you a chain of objects.
                                    Look for your Fragment class name in the list.</p>
                                <div class="callout callout-tip">
                                    <div class="callout-icon">üîç</div>
                                    <div><strong>Detective Work:</strong> Look for the red wavy line in the trace.
                                        That's usually where the reference "hangs on" incorrectly.</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-card">
                        <div class="flex items-start gap-3">
                            <span class="step-number">5</span>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">The "Fix" and Verification</h4>
                                <p class="text-sm text-gray-600 mb-3">Implement the standard nullification pattern and
                                    verify that the leak disappears.</p>
                                <div class="code-block"><span class="code-label">Kotlin</span>
                                    <pre>class SafeFragment : Fragment(R.layout.fragment_safe) {
    private var _binding: FragmentSafeBinding? = null
    private val binding get() = _binding!!

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        _binding = FragmentSafeBinding.bind(view)
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null // THIS FIXES THE LEAK
    }
}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- EXPERIMENTS -->
                <section id="experiments" class="content-section animate-in">
                    <h2>üß™ Possible Experiments</h2>

                    <div class="space-y-4">
                        <div class="bg-white rounded-xl border-2 p-5" style="border-color:#F3E5F5;">
                            <div class="flex items-center gap-2 mb-3">
                                <span
                                    class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 text-purple-700 font-bold text-sm">A</span>
                                <h4 class="font-semibold text-gray-800">The "Death by 1000 Rotations"</h4>
                            </div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Question:</strong> How many screen rotations
                                does it take to run out of memory if you have a leak?</p>
                            <p class="text-sm text-gray-600"><strong>Method:</strong> Create a Fragment that loads a
                                large image. Rotate the screen 20 times. Use the Android Studio Memory Profiler to see
                                if memory keeps going up (leaking) or stays stable (reclaiming).</p>
                        </div>

                        <div class="bg-white rounded-xl border-2 p-5" style="border-color:#E3F2FD;">
                            <div class="flex items-center gap-2 mb-3">
                                <span
                                    class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-700 font-bold text-sm">B</span>
                                <h4 class="font-semibold text-gray-800">Context Leaks</h4>
                            </div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Question:</strong> What happens if you pass a
                                Fragment's `requireContext()` to a long-running background task?</p>
                            <p class="text-sm text-gray-600"><strong>Method:</strong> Start a 30-second Timer in a
                                Fragment. Close the Fragment. Does the Fragment stay in memory until the timer ends? Use
                                LeakCanary to find out.</p>
                        </div>

                        <div class="bg-white rounded-xl border-2 p-5" style="border-color:#E8F5E9;">
                            <div class="flex items-center gap-2 mb-3">
                                <span
                                    class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 text-green-700 font-bold text-sm">C</span>
                                <h4 class="font-semibold text-gray-800">Static Variable Test</h4>
                            </div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Question:</strong> Is storing a View in a
                                companion object (static) the ultimate leak?</p>
                            <p class="text-sm text-gray-600"><strong>Method:</strong> Create a Fragment. Save its root
                                view into a <code class="bg-gray-50 px-1 rounded text-xs">static</code> variable. Close
                                the app activity but don't kill the process. Use the Profiler's "Heap Dump" to prove the
                                view is still there.</p>
                        </div>
                    </div>
                </section>

                <!-- ALTERNATIVES -->
                <section id="alternatives" class="content-section animate-in">
                    <h2>üîÑ Alternative Approaches</h2>
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-gray-50 to-white rounded-xl p-5 border"
                            style="border-color:var(--border-light);">
                            <h4 class="font-semibold text-tru-primary mb-2">Pure Lifecycle Logging</h4>
                            <p class="text-sm text-gray-600">If LeakCanary is too confusing, use
                                <strong>Logcat</strong>. In every lifecycle method (`onAttach`, `onCreate`,
                                `onCreateView`, `onDestroyView`, `onDetach`), add a <code
                                    class="bg-gray-50 px-1 rounded text-xs">Log.d("Lifecycle", "Fragment X: onMethod")</code>.
                                Watch the logs as you navigate. Does anything surprise you?</p>
                        </div>
                        <div class="bg-gradient-to-r from-gray-50 to-white rounded-xl p-5 border"
                            style="border-color:var(--border-light);">
                            <h4 class="font-semibold text-tru-primary mb-2">The "Process Death" Simulation</h4>
                            <p class="text-sm text-gray-600">Research what happens when Android kills your app's process
                                to save RAM for other apps. Learn how to use the <strong>"Don't keep
                                    activities"</strong> setting in Developer Options to simulate this. This is the
                                ultimate test of your Fragment logic!</p>
                        </div>
                    </div>
                </section>

                <!-- POSTER TIPS -->
                <section id="poster-tips" class="content-section animate-in">
                    <h2>üé® Tips for Your Research Poster</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-teal-50 rounded-xl p-5 border border-teal-100">
                            <h4 class="font-semibold text-tru-primary mb-2">üìä Essential Visuals</h4>
                            <ul class="text-sm text-gray-600 space-y-2 list-disc ml-4">
                                <li>LeakCanary notification and leak trace screenshots</li>
                                <li>Memory Profiler graph showing a "stairs" pattern (memory going up but never down)
                                </li>
                                <li>Flowchart of the Fragment Lifecycle</li>
                            </ul>
                        </div>
                        <div class="bg-amber-50 rounded-xl p-5 border border-amber-100">
                            <h4 class="font-semibold text-tru-primary mb-2">‚úçÔ∏è Content Focus</h4>
                            <p class="text-sm text-gray-600">Explain <strong>Why</strong> it matters. A slow app is
                                annoying, but an app that crashes because of memory leaks is unusable. Your poster
                                should educate other students on how to avoid these common invisible bugs.</p>
                        </div>
                    </div>
                </section>

                <!-- PITFALLS -->
                <section id="pitfalls" class="content-section animate-in">
                    <h2>‚ö†Ô∏è Common Pitfalls &amp; FAQ</h2>
                    <div class="space-y-4">
                        <details class="bg-gray-50 rounded-xl border p-4" style="border-color:var(--border-light);">
                            <summary class="font-semibold text-gray-700 cursor-pointer">"LeakCanary says there's a leak
                                in the Android System code!"</summary>
                            <p class="text-sm text-gray-600 mt-3">This is common! Sometimes the Android OS itself has
                                small "leaks." You can usually ignore these if your own Fragment classes aren't in the
                                leak trace. Focus on the leaks YOU created.</p>
                        </details>
                        <details class="bg-gray-50 rounded-xl border p-4" style="border-color:var(--border-light);">
                            <summary class="font-semibold text-gray-700 cursor-pointer">"Why do I need to nullify View
                                Binding in Fragments but not Activities?"</summary>
                            <p class="text-sm text-gray-600 mt-3">Great question! In an Activity, when it's destroyed,
                                the whole object is gone. But in a Fragment, the <strong>View</strong> can be destroyed
                                while the <strong>Fragment instance</strong> is kept in the back stack. If you don't
                                nullify the binding, that Fragment object is "hanging on" to a dead View hierarchy.</p>
                        </details>
                    </div>
                </section>

                <!-- CHECKLIST -->
                <section id="checklist" class="content-section animate-in">
                    <h2>‚úÖ Research Checklist</h2>
                    <div class="space-y-1">
                        <div class="checklist-item">
                            <div class="checklist-box"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Add the Fragment lifecycle logging to your
                                    code</p>
                            </div>
                        </div>
                        <div class="checklist-item">
                            <div class="checklist-box"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Install LeakCanary to your project</p>
                            </div>
                        </div>
                        <div class="checklist-item">
                            <div class="checklist-box"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Purposefully create and trigger a memory
                                    leak</p>
                            </div>
                        </div>
                        <div class="checklist-item">
                            <div class="checklist-box"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Capture a LeakCanary trace for your poster
                                </p>
                            </div>
                        </div>
                        <div class="checklist-item">
                            <div class="checklist-box"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Fix the leak and verify it's gone</p>
                            </div>
                        </div>
                        <div class="checklist-item">
                            <div class="checklist-box"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Explain the "Back Stack" vs "View
                                    Destruction" in your findings</p>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-tru-primary text-white/70 py-8 mt-8">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-sm"><a href="../index.html" class="text-white hover:text-tru-accent transition-colors">‚Üê
                    Back to All Topics</a></div>
            <div class="text-sm">Created by <span class="font-semibold text-white">Research Coaches</span> for guidance.
            </div>
        </div>
    </footer>

    <script>
        const sections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.sidebar-nav a');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => link.classList.remove('active'));
                    const id = entry.target.id;
                    const activeLink = document.querySelector(`.sidebar-nav a[href="#${id}"]`);
                    if (activeLink) activeLink.classList.add('active');
                }
            });
        }, { rootMargin: '-20% 0px -70% 0px' });
        sections.forEach(s => observer.observe(s));
        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const id = link.getAttribute('href').substring(1);
                document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>

</html>